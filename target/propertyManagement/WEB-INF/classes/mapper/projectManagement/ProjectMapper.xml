<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.propertyManagement.mapper.projectManagement.ProjectMapper">
    <select id="getProjects" resultType="Project">
        SELECT * FROM project;
    </select>
    <select id="getTasksBySIdAndPId" resultType="Task">
        SELECT * from task where staffId = #{0} and projectId = #{1};
    </select>
    <select id="getProjectsByStaffId" resultType="Project" parameterType="int">
        SELECT * FROM project where id in (select projectId from task where staffId = #{0} group by projectId);
    </select>
    <select id="getProjectInfoById" resultType="Project" parameterType="int">
        SELECT * from project where id = #{0};
    </select>
    <select id="getContractInfoById" resultType="Contract" parameterType="int">
        SELECT * from contract where projectId = #{0};
    </select>
    <!--<select id="getClientInfo" resultType="Client" parameterType="int">-->
        <!--SELECT * FROM client where id = (SELECT clientId from contract where id = #{0});-->
    <!--</select>-->
    <insert id="addProject" parameterType="Project">
        INSERT into project(name, description, planNum, planMoney, companyId) VALUES(#{name}, #{description}, #{planNum}, #{planMoney}, #{companyId});
        <selectKey keyProperty="id" order="AFTER" resultType="int">
            SELECT LAST_INSERT_ID();
        </selectKey>
    </insert>
    <insert id="addTask">
        INSERT into task(name, description, projectId, staffId) VALUES(#{0}, #{1}, #{2}, #{3});
    </insert>
    <insert id="addContract">
        INSERT INTO contract(projectId, name, startDate, endDate, workContent, totalMoney, frequency, receive, receiveMoney, remark, clientId) VALUES (#{0}, #{1}, #{2}, #{3}, #{4}, #{5}, #{6}, #{7}, #{8}, #{9}, #{10});
    </insert>
    <delete id="deleteTaskById" parameterType="int">
        DELETE from task WHERE id = #{0};
    </delete>
    <delete id="deleteContractById" parameterType="int">
        DELETE from contract WHERE id = #{0};
    </delete>
    <delete id="deleteProjectById" parameterType="int">
        DELETE from project where id = #{0};
    </delete>
    <delete id="deleteContract" parameterType="int">
        DELETE FROM contract WHERE projectId = #{0};
    </delete>
    <update id="updateProjectInfo">
        UPDATE project SET name = #{1}, description = #{2}, planNum = #{3}, currentNum = #{4}, planMoney = #{5}, currentMoney = #{6}, state = #{7}
        WHERE id = #{0};
    </update>
    <update id="updateContractInfo">
        UPDATE contract SET name = #{1}, startDate = #{2}, endDate = #{3}, workContent = #{4}, totalMoney = #{5}, frequency = #{6}, receive = #{7}, receiveMoney = #{8}, remark = #{9}
        WHERE id = #{0};
    </update>
</mapper>